syntax = "proto3";
package ploioproto;

service PloioAPI {
  rpc ListApplications (ApplicationGet) returns (ApplicationList) {}
  rpc GetApplication (ApplicationGet) returns (Application) {}
  rpc CreateApplication (ApplicationCreate) returns (Application) {}
  rpc ListClusters (ClusterGet) returns (ClusterList) {}
  rpc ListPipelines (PipelineGet) returns (PipelineList) {}
  rpc CreatePipeline (PipelineCreate) returns (Pipeline) {}
  rpc CreateStep (Step) returns (Step) {}
  rpc ListStep (StepGet) returns (StepList) {}
}



message ApplicationCreate {
    string Name = 1;
    string Owner = 2;
    string Repo = 3;
    bool Stateful = 4;
}

message ApplicationGet {
    string ID = 1;
    string Name = 2;
}

message ApplicationList {
    repeated Application Applications = 1;
}


message Application {
    string ID = 1;
    string Name = 2;
    string Owner = 3;
    string Repo = 4;
    bool Stateful = 5;

    repeated Pipeline Pipelines = 6;
    repeated EnvVar EvnVars = 7;
    repeated Volume Volumes = 8;
}

message Pipeline {
    string ID = 1;
    string Name = 2;
    string Application = 3;
    int32 Order = 4;
    repeated Step Steps = 5;
}

message PipelineGet {
    string Application = 1;
    string Name = 2;
}

message PipelineList {
    repeated Pipeline Pipelines = 1;
}

message PipelineCreate {
    string Application = 1;
    string Name = 2;
}

message Step {
    string ID = 1;
    string Name = 2;
    string Pipeline = 3;
    StepType Type = 4;
    int32 Order = 5;
    string Memory = 6;
    string Proc = 7;
    int32 Replicas = 8;
}

message StepGet {
    string Pipeline = 1;
    string Name = 2;
}

message StepList {
    repeated Step Steps = 1;
}

enum StepType {
   Deploy = 0;
   DeployBlueGreen = 1;
   DeployCanary = 2;
   DeployManualCheck = 3;
   ManualCheck = 4;
}

message EnvVar {
    string ID = 1;
    string Name = 2;
    EnvVarType Type = 3;
    string Key = 4;
    string Value = 5;
    string ConfigMap = 6;
}

enum EnvVarType {
    ConfigMap = 0;
}

message Volume {
    string ID = 1;
    string Name = 2;
}

message Cluster {
    string ID = 1;
    string Name = 2;
    string Host = 3;
}

message ClusterGet {
    string Name = 1;
}

message ClusterList {
    repeated Cluster Clusters = 1;
}


